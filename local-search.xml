<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Docker理解与安装</title>
    <link href="/2024/04/05/Docker%E7%90%86%E8%A7%A3%E4%B8%8E%E5%AE%89%E8%A3%85/"/>
    <url>/2024/04/05/Docker%E7%90%86%E8%A7%A3%E4%B8%8E%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<h1 id="什么是Docker"><a href="#什么是Docker" class="headerlink" title="什么是Docker"></a>什么是Docker</h1><blockquote><p>Docker 图标鲸鱼背着集装箱，码头工人，整体搬运，是一种虚拟化技术，虚拟机，通过与操作系统协商独占硬件资源（磁盘内存等）独立一个进程，里面软件需要想普通软件一样安装，所谓运行软件，将文件中的内容搬运到内存中，让cpu进行运算（各个任务之间需要调度），以前虚拟出2个不干扰的程序（2个tomcat），除了tomcat本身需要的资源，还需要虚拟机的操作系统额外占用的资源，将虚拟任务 虚拟成线程让docker管理，真实机器操作系统只需要和docker交互就可以了。</p><p>实现所谓的虚拟技术，就是资源可用， 磁盘可访问（docker安装有自己的文件夹，安装的虚拟线程tomcat 也就在这个文件里面保存文件，cpu 虚拟线程找docker进程协调资源，docker的进程找操作系统协调资源，网络各个虚拟线程和docker进程之间是桥接关系，docker安装完成会装一个虚拟网卡）</p></blockquote><h1 id="Docker安装"><a href="#Docker安装" class="headerlink" title="Docker安装"></a>Docker安装</h1><h2 id="yum-安装"><a href="#yum-安装" class="headerlink" title="yum 安装"></a>yum 安装</h2><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">yum <span class="hljs-keyword">install</span> docker<br></code></pre></td></tr></table></figure><p>启动Docker</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">systemctl <span class="hljs-literal">start</span> docker<br></code></pre></td></tr></table></figure><p>安装好后 配置国内镜像源</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">curl -sSL https:<span class="hljs-regexp">//g</span>et.daocloud.io<span class="hljs-regexp">/daotools/</span>set_mirror.sh | sh -s http:<span class="hljs-regexp">//</span>f1361db2.m.daocloud.io<br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs awk">vi  <span class="hljs-regexp">/etc/</span>docker/daemon.json<br><br>&#123;<br>     <span class="hljs-string">&quot;registry-mirrors&quot;</span>: [<br>         <span class="hljs-string">&quot;https://registry.docker-cn.com&quot;</span>,<br>         <span class="hljs-string">&quot;http://hub-mirror.c.163.com&quot;</span>,<br>         <span class="hljs-string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span><br>     ]<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="D:/Typora/img/clip_image002.jpg" alt="img"></p><p> 查看已下载的镜像（就是静态的模板软件）</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker images</span><br></code></pre></td></tr></table></figure><p>拉取Redis镜像</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker pull redis</span><br></code></pre></td></tr></table></figure><p><img src="/images/clip_image004.jpg" alt="img"></p><blockquote><p>创建一个容器的时候，docker 会自动对它进行命名</p><p><strong>-P</strong> <strong>：</strong>是容器内部端口<strong>随机</strong>映射到主机的端口。</p><p><strong>-p</strong> <strong>：</strong>是容器内部端口绑定到<strong>指定</strong>的主机端口，默认都是绑定 tcp 端口，如果要绑定 UDP 端口，可以在端口后面加上 <strong>&#x2F;udp</strong>。</p><p><strong>–name</strong> <strong>：</strong>命名容器。</p><p><strong>-d</strong>：指定 docker 网络类型，有 bridge、overlay。</p><p>-v $PWD&#x2F;test：&#x2F;test：将主机中当前目录下的test 挂载到容器的 &#x2F;test。</p></blockquote><p>运行Redis容器</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> run --name redis -d -p <span class="hljs-number">6379</span>:<span class="hljs-number">6379</span> redis:latest<br></code></pre></td></tr></table></figure><p>查看所有的容器</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">docker ps -<span class="hljs-selector-tag">a</span><br></code></pre></td></tr></table></figure><p>启动Redis容器</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">docker <span class="hljs-literal">start</span> redis<br></code></pre></td></tr></table></figure><p>物理机访问</p><p><img src="/images/clip_image006.jpg" alt="img"></p><p>可以进入 运行中的容器 容器名字 不能进 就使用ID</p><p>docker exec -it redis &#x2F;bin&#x2F;bash</p><p>进入容器 没有vi命令 编辑需要安装vim</p><p>如果直接敲apt-get install vim命令则会有如下提示</p><p><img src="/images/clip_image008.jpg" alt="img"></p><p>我们需要先敲入apt-get update命令，这个命令的作用是：同步 &#x2F;etc&#x2F;apt&#x2F;sources.list 和 &#x2F;etc&#x2F;apt&#x2F;sources.list.d 中列出的源的索引，这样才能获取到最新的软件包。</p><p><img src="/images/clip_image010.jpg" alt="img"></p><p>然后使用apt-get install vim安装vim。</p><p>海外源 网络慢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mv</span> /etc/apt/sources.list /etc/apt/sources.list.bak<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;deb http://mirrors.163.com/debian/ jessie main non-free contrib&quot;</span> &gt;&gt;<br>/etc/apt/sources.list<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;deb http://mirrors.163.com/debian/ jessie-proposed-updates main non-free contrib&quot;</span> &gt;&gt;/etc/apt/sources.list<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;deb-src http://mirrors.163.com/debian/ jessie main non-free contrib&quot;</span> &gt;&gt;/etc/apt/sources.list<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;deb-src http://mirrors.163.com/debian/ jessie-proposed-updates main non-free contrib&quot;</span> &gt;&gt;/etc/apt/sources.list<br></code></pre></td></tr></table></figure><p>如果要发布项目 建立好 test 项目与 html 文件 拷贝test目录到docker中的tomcat的webapps中，需要主要查看docker中 tomcat的安装路径（pwd）</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker cp <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/tomcat/</span>webapps tomcat:<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/tomcat/</span>webapps/<br></code></pre></td></tr></table></figure><p><img src="/images%5Cimage-20221130173819977.png" alt="img"></p><p>将容器中的文件拷贝出来</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker cp nginx:<span class="hljs-regexp">/etc/</span>nginx<span class="hljs-regexp">/nginx.conf /u</span>sr<span class="hljs-regexp">/ftp/</span>nginx.conf<br>docker cp <span class="hljs-regexp">/usr/</span>ftp<span class="hljs-regexp">/nginx.conf nginx:/</span>etc<span class="hljs-regexp">/nginx/</span>nginx.conf<br></code></pre></td></tr></table></figure><h1 id="私服搭建"><a href="#私服搭建" class="headerlink" title="私服搭建"></a>私服搭建</h1><p>为什么要搭建本地仓库？</p><blockquote><p>Docker 运行软件是由镜像 images 产生container 容器来运行，本来是从docker中央仓库或者镜像仓库。</p><p>如果自己在公司局域网中要快速搭建docker环境就需要搭建本地仓库，搭建本地仓库的电脑可以把公共仓库中的镜像直接上传到本地仓库，也可以把自己修改了配置的容器打包成自己的镜像上传到本地仓库就大大节约了下载和每一台都要重新配置的时间</p></blockquote><p>docker下载registry软件</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker pull daocloud.io<span class="hljs-regexp">/library/</span>registry:latest<br></code></pre></td></tr></table></figure><p>查看镜像</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker images</span><br></code></pre></td></tr></table></figure><p>生成容器和端口映射</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">docker <span class="hljs-built_in">run</span> -d -p 5000:5000 <span class="hljs-attribute">--restart</span>=always --name myregistry daocloud.io/library/registry:latest<br></code></pre></td></tr></table></figure><p>将容器打包贴自己的标签 例如 我设置自定义名字为 redis 标tag也可以理解为版本号my</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">docker <span class="hljs-keyword">tag</span> docker.io/tomca<span class="hljs-variable">t:latest</span> localhos<span class="hljs-variable">t:5000</span>/<span class="hljs-keyword">redi</span><span class="hljs-variable">s:my</span><br></code></pre></td></tr></table></figure><p>推送到指定仓库</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">docker push localhos<span class="hljs-variable">t:5000</span>/<span class="hljs-keyword">redi</span><span class="hljs-variable">s:my</span><br></code></pre></td></tr></table></figure><p>查看指定仓库的资源 </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl http://localhost:5000/v2/_catalog<br></code></pre></td></tr></table></figure><p><img src="/images%5Cclip_image012.jpg" alt="img"></p><p>查看指定镜像的版本</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">curl http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">139.123</span>:<span class="hljs-number">5000</span><span class="hljs-regexp">/v2/</span>redis<span class="hljs-regexp">/tags/</span>list<br></code></pre></td></tr></table></figure><p><img src="/images/clip_image014.jpg" alt="img"></p><p>其他电脑如何获取资源</p><p>其他机器要从指定的仓库拉取镜像，首先要保证上述的网址能够打开</p><p><a href="http://192.168.139.123:5000/v2/redis/tags/list">http://192.168.139.123:5000/v2/redis/tags/list</a></p><p>修改本地docker deamon.json</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">vi <span class="hljs-regexp">/etc/</span>docker/daemon.json<br></code></pre></td></tr></table></figure><p>在默认资源的后面添加指定仓库</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs prolog">&#123;<br><span class="hljs-string">&quot;registry-mirrors&quot;</span>: [<br><span class="hljs-string">&quot;https://registry.docker-cn.com&quot;</span>,<br><span class="hljs-string">&quot;http://hub-mirror.c.163.com&quot;</span>,<br><span class="hljs-string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span><br>],<br><span class="hljs-string">&quot;insecure-registries&quot;</span>:[<span class="hljs-string">&quot;192.168.139.123:5000&quot;</span>]<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/images/clip_image016.jpg" alt="img"></p><p>从指定仓库拉取 指定版本的指定镜像 ，名称要全部正确</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">docker</span> pull <span class="hljs-number">192.168.139.123</span>/redis:my<br></code></pre></td></tr></table></figure><p><strong>配置</strong> <strong>DNS</strong></p><p>我们可以在宿主机的 &#x2F;etc&#x2F;docker&#x2F;daemon.json 文件中增加以下内容来设置全部容器的 DNS：</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ada">&#123;<br> <span class="hljs-string">&quot;dns&quot;</span> : [<br> <span class="hljs-string">&quot;114.114.114.114&quot;</span>,<br>  <span class="hljs-string">&quot;8.8.8.8&quot;</span><br> ]<br>&#125;<br></code></pre></td></tr></table></figure><p>设置后，启动容器的 DNS 会自动配置为 114.114.114.114 和 8.8.8.8。</p><p>配置完，需要重启 docker 才能生效。</p><p>查看容器的 DNS 是否生效可以使用以下命令，它会输出容器的 DNS 信息：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">docker <span class="hljs-keyword">run</span><span class="language-bash"> -it --<span class="hljs-built_in">rm</span> centos <span class="hljs-built_in">cat</span> etc/resolv.conf</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>运维</tag>
      
      <tag>Docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
